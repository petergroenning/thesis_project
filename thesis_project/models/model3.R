make_model<-function(model){
    # Add observation equations
    model$addObs(X0 ~ x0m)
    model$addObs(X1 ~ x1m)
    model$addObs(X2 ~ x2m)
    model$addObs(X3 ~ x3m)
    model$addObs(X4 ~ x4m)
    model$addObs(X5 ~ x5m)
    model$addObs(X6 ~ x6m)
    model$addObs(X7 ~ x7m)
    model$addObs(X8 ~ x8m)
    model$addObs(X9 ~ x9m)
    model$addObs(X10 ~ x10m)
    model$addObs(X11 ~ x11m)
    model$addObs(X12 ~ x12m)
    model$addObs(X13 ~ x13m)
    model$addObs(X14 ~ x14m)
    model$addObs(X15 ~ x15m)

    # Set observation equation variances
    model$setVariance(X0 ~ sigma_X0^2)
    model$setVariance(X1 ~ sigma_X1^2)
    model$setVariance(X2 ~ sigma_X2^2)
    model$setVariance(X3 ~ sigma_X3^2)
    model$setVariance(X4 ~ sigma_X4^2)
    model$setVariance(X5 ~ sigma_X5^2)
    model$setVariance(X6 ~ sigma_X6^2)
    model$setVariance(X7 ~ sigma_X7^2)
    model$setVariance(X8 ~ sigma_X8^2)
    model$setVariance(X9 ~ sigma_X9^2)
    model$setVariance(X10 ~ sigma_X10^2)
    model$setVariance(X11 ~ sigma_X11^2)
    model$setVariance(X12 ~ sigma_X12^2)
    model$setVariance(X13 ~ sigma_X13^2)
    model$setVariance(X14 ~ sigma_X14^2)
    model$setVariance(X15 ~ sigma_X15^2)

    model$setParameter(sigma_X0 = c(init=2e-4,lb=0,ub=10))
    model$setParameter(sigma_X1 = c(init=2e-4,lb=0,ub=10))
    model$setParameter(sigma_X2 = c(init=2e-4,lb=0,ub=10))
    model$setParameter(sigma_X3 = c(init=2e-4,lb=0,ub=10))
    model$setParameter(sigma_X4 = c(init=2e-4,lb=0,ub=10))
    model$setParameter(sigma_X5 = c(init=2e-4,lb=0,ub=10))
    model$setParameter(sigma_X6 = c(init=2e-4,lb=0,ub=10))
    model$setParameter(sigma_X7 = c(init=2e-4,lb=0,ub=10))
    model$setParameter(sigma_X8 = c(init=2e-4,lb=0,ub=10))
    model$setParameter(sigma_X9 = c(init=2e-4,lb=0,ub=10))
    model$setParameter(sigma_X10 = c(init=2e-4,lb=0,ub=10))
    model$setParameter(sigma_X11 = c(init=2e-4,lb=0,ub=10))
    model$setParameter(sigma_X12 = c(init=2e-4,lb=0,ub=10))
    model$setParameter(sigma_X13 = c(init=2e-4,lb=0,ub=10))
    model$setParameter(sigma_X14 = c(init=2e-4,lb=0,ub=10))
    model$setParameter(sigma_X15 = c(init=2e-4,lb=0,ub=10))

    model$addInput('FbotIn','FbotOut','Fbot','Tbot','FmidIn','FmidOut','Fmid','Tmid','FtopIn','FtopOut','Ftop','Ttop')
    #Addsystemequations
    model$addSystem(dY0m~dt*(x0m-Y0m)*b0+sigma_y0*dwy0)
    model$addSystem(dx0m~dt*((Y0m-x0m)*a0+((Tbot-x0m)*(v0)*(FbotIn)+(x1m-x0m)*(k0+f10*(FbotOut)))/V0)+sigma_x0*dw0)  

    model$addSystem(dY1m~dt*(x1m-Y1m)*b1+sigma_y1*dwy1)
    model$addSystem(dx1m~dt*((Y1m-x1m)*a1+((x0m-x1m)*(f11*(FbotIn))+(x2m-x1m)*(f21*(FbotOut)))/V1)+(sigma_x1)*dw1)

    model$addSystem(dY2m~dt*(x2m-Y2m)*b2+sigma_y2*dwY2)
    model$addSystem(dx2m~dt*((Y2m-x2m)*a2+((x1m-x2m)*(f12*(FbotIn))+(x3m-x2m)*(f22*(FbotOut)))/V2)+(sigma_x2)*dw2)

    model$addSystem(dY3m~dt*(x3m-Y3m)*b3+sigma_y3*dwY3)
    model$addSystem(dx3m~dt*((Y3m-x3m)*a3+((x2m-x3m)*(f13*(FbotIn))+(x4m-x3m)*(f23*(FbotOut)))/V3)+(sigma_x3)*dw3)

    model$addSystem(dY4m~dt*(x4m-Y4m)*b4+sigma_y4*dwY4)
    model$addSystem(dx4m~dt*((Y4m-x4m)*a4+((x3m-x4m)*(f14*(FbotIn))+(x5m-x4m)*(f24*(FbotOut)))/V4)+(sigma_x4)*dw4)
    
    model$addSystem(dY5m~dt*(x5m-Y5m)*b5+sigma_y5*dwY5)
    model$addSystem(dx5m~dt*((Y5m-x5m)*a5+((x4m-x5m)*(f15*(FbotIn))+(x6m-x5m)*(f25*(FbotOut)))/V5)+(sigma_x5)*dw5)

    model$addSystem(dY6m~dt*(x6m-Y6m)*b6+sigma_y6*dwY6)
    model$addSystem(dx6m~dt*((Y6m-x6m)*a6+((x5m-x6m)*(f16*(FbotIn))+(x7m-x6m)*(f26*(FbotOut)))/V6)+(sigma_x6)*dw6)
    
    model$addSystem(dY7m~dt*(x7m-Y7m)*b7+sigma_y7*dwY7)
    model$addSystem(dx7m~dt*((Y7m-x7m)*a7+((x6m-x7m)*(f17*(FbotIn))+(x8m-x7m)*(f27*(FbotOut)))/V7)+(sigma_x7)*dw7)
    
    model$addSystem(dY8m~dt*((x8m-Y8m)*b8)+sigma_y8*dwY8)
    model$addSystem(dx8m~dt*((Y8m-x8m)*a8+((x7m-x8m)*(f18*(FbotIn))+(x9m-x8m)*(f28*(FbotOut)))/V8)+(sigma_x8)*dw8)

    model$addSystem(dY9m~dt*(x9m-Y9m)*b9+sigma_y9*dwY9)
    model$addSystem(dx9m~dt*((Y9m-x9m)*a9+((x8m-x9m)*(f19*(FbotIn))+(x10m-x9m)*(f29*(FbotOut)))/V9)+(sigma_x9)*dw9)

    model$addSystem(dY10m~dt*(x10m-Y10m)*b10+sigma_y10*dwY10)
    model$addSystem(dx10m~dt*((Y10m-x10m)*a10+((x9m-x10m)*(f110*(FbotIn))+(x11m-x10m)*(f210*(FbotOut))+(Tmid-x10m)*fmid*FmidIn)/V9)+(sigma_x10)*dw10)

    model$addSystem(dY11m~dt*(x11m-Y11m)*b11+sigma_y11*dwY11)
    model$addSystem(dx11m~dt*((Y11m-x11m)*a11+((x10m-x11m)*(f111*(FtopOut))+(x12m-x11m)*(f211*(FtopIn)))/V11)+(sigma_x11)*dw11)

    model$addSystem(dY12m~dt*(x12m-Y12m)*b12+sigma_y12*dwY12)
    model$addSystem(dx12m~dt*((Y12m-x12m)*a12+((x11m-x12m)*(f112*(FtopOut))+(x13m-x12m)*(f212*(FtopIn)))/V12)+(sigma_x12)*dw12)

    model$addSystem(dY13m~dt*(x13m-Y13m)*b13+sigma_y13*dwY13)
    model$addSystem(dx13m~dt*((Y13m-x13m)*a13+((x12m-x13m)*(f113*(FtopOut))+(x14m-x13m)*(f213*(FtopIn)))/V13)+(sigma_x13)*dw13)

    model$addSystem(dY14m~dt*(x14m-Y14m)*b14+sigma_y14*dwY14)
    model$addSystem(dx14m~dt*((Y14m-x14m)*a14+((x13m-x14m)*(f114*(FtopOut))+(x15m-x14m)*(f214*(FtopIn)))/V14)+(sigma_x14)*dw14)

    model$addSystem(dY15m~dt*(x15m-Y15m)*b15+sigma_y15*dwY15)
    model$addSystem(dx15m~dt*((Y15m-x15m)*a15+((Ttop-x15m)*(v15)*(FtopIn)+(x14m-x15m)*(k15+f215*FtopOut)+(ambientTemp-x15m)*u)/V15)+(sigma_x15)*dw15)

    # Set parameters
    model$setParameter(sigma_y0 = c(init=1e-2,lb=0,ub=1))
    model$setParameter(sigma_y1 = c(init=1e-2,lb=0,ub=1))
    model$setParameter(sigma_y2 = c(init=1e-2,lb=0,ub=1))
    model$setParameter(sigma_y3 = c(init=1e-2,lb=0,ub=1))
    model$setParameter(sigma_y4 = c(init=1e-2,lb=0,ub=1))
    model$setParameter(sigma_y5 = c(init=1e-2,lb=0,ub=1))
    model$setParameter(sigma_y6 = c(init=1e-2,lb=0,ub=1))
    model$setParameter(sigma_y7 = c(init=1e-2,lb=0,ub=1))
    model$setParameter(sigma_y8 = c(init=1e-2,lb=0,ub=1))
    model$setParameter(sigma_y9 = c(init=1e-2,lb=0,ub=1))
    model$setParameter(sigma_y10 = c(init=1e-2,lb=0,ub=1))
    model$setParameter(sigma_y11 = c(init=1e-2,lb=0,ub=1))
    model$setParameter(sigma_y12 = c(init=1e-2,lb=0,ub=1))
    model$setParameter(sigma_y13 = c(init=1e-2,lb=0,ub=1))
    model$setParameter(sigma_y14 = c(init=1e-2,lb=0,ub=1))
    model$setParameter(sigma_y15 = c(init=1e-2,lb=0,ub=1))

    model$setParameter(sigma_x0 = c(init=1e-3,lb=0,ub=1))
    model$setParameter(sigma_x1 = c(init=1e-3,lb=0,ub=1))
    model$setParameter(sigma_x2 = c(init=1e-3,lb=0,ub=1))
    model$setParameter(sigma_x3 = c(init=1e-3,lb=0,ub=1))
    model$setParameter(sigma_x4 = c(init=1e-3,lb=0,ub=1))
    model$setParameter(sigma_x5 = c(init=1e-3,lb=0,ub=1))
    model$setParameter(sigma_x6 = c(init=1e-3,lb=0,ub=1))
    model$setParameter(sigma_x7 = c(init=1e-3,lb=0,ub=1))
    model$setParameter(sigma_x8 = c(init=1e-3,lb=0,ub=1))
    model$setParameter(sigma_x9 = c(init=1e-3,lb=0,ub=1))
    model$setParameter(sigma_x10 = c(init=1e-3,lb=0,ub=1))
    model$setParameter(sigma_x11 = c(init=1e-3,lb=0,ub=1))
    model$setParameter(sigma_x12 = c(init=1e-3,lb=0,ub=1))
    model$setParameter(sigma_x13 = c(init=1e-3,lb=0,ub=1))
    model$setParameter(sigma_x14 = c(init=1e-3,lb=0,ub=1))
    model$setParameter(sigma_x15 = c(init=1e-3,lb=0,ub=1))

    model$setParameter(a0 = c(init=1,lb=0,ub=2))
    model$setParameter(a1 = c(init=1,lb=0,ub=2))
    model$setParameter(a2 = c(init=1,lb=0,ub=2))
    model$setParameter(a3 = c(init=1,lb=0,ub=2))
    model$setParameter(a4 = c(init=1,lb=0,ub=2))
    model$setParameter(a5 = c(init=1,lb=0,ub=2))
    model$setParameter(a6 = c(init=1,lb=0,ub=2))
    model$setParameter(a7 = c(init=1,lb=0,ub=2))
    model$setParameter(a8 = c(init=1,lb=0,ub=2))
    model$setParameter(a9 = c(init=1,lb=0,ub=2))
    model$setParameter(a10 = c(init=1,lb=0,ub=2))
    model$setParameter(a11 = c(init=1,lb=0,ub=2))
    model$setParameter(a12 = c(init=1,lb=0,ub=2))
    model$setParameter(a13 = c(init=1,lb=0,ub=2))
    model$setParameter(a14 = c(init=1,lb=0,ub=2))
    model$setParameter(a15 = c(init=1,lb=0,ub=2))


    model$setParameter(b0 = c(init=1,lb=0,ub=2))
    model$setParameter(b1 = c(init=1,lb=0,ub=2))
    model$setParameter(b2 = c(init=1,lb=0,ub=2))
    model$setParameter(b3 = c(init=1,lb=0,ub=2))
    model$setParameter(b4 = c(init=1,lb=0,ub=2))
    model$setParameter(b5 = c(init=1,lb=0,ub=2))
    model$setParameter(b6 = c(init=1,lb=0,ub=2))
    model$setParameter(b7 = c(init=1,lb=0,ub=2))
    model$setParameter(b8 = c(init=1,lb=0,ub=2))
    model$setParameter(b9 = c(init=1,lb=0,ub=2))
    model$setParameter(b10 = c(init=1,lb=0,ub=2))
    model$setParameter(b11 = c(init=1,lb=0,ub=2))
    model$setParameter(b12 = c(init=1,lb=0,ub=2))
    model$setParameter(b13 = c(init=1,lb=0,ub=2))
    model$setParameter(b14 = c(init=1,lb=0,ub=2))
    model$setParameter(b15 = c(init=1,lb=0,ub=2))

    model$setParameter(v0 = c(init=0,lb=-4,ub=5))
    model$setParameter(v15 = c(init=0,lb=-4,ub=5))
    model$setParameter(fmid = c(init=1,lb=0,ub=10))
    model$setParameter(u = c(init=1e-6,lb=0,ub=40))
    model$setParameter(k0= c(init=1,lb=0,ub=10))
    model$setParameter(k15= c(init=1,lb=0,ub=10))

    model$setParameter(f10 = c(init=1,lb=0,ub=10))
    model$setParameter(f11 = c(init=1,lb=0,ub=10))
    model$setParameter(f12 = c(init=1,lb=0,ub=10))
    model$setParameter(f13 = c(init=1,lb=0,ub=10))
    model$setParameter(f14 = c(init=1,lb=0,ub=10))
    model$setParameter(f15 = c(init=1,lb=0,ub=10))
    model$setParameter(f16 = c(init=1,lb=0,ub=10))
    model$setParameter(f17 = c(init=1,lb=0,ub=10))
    model$setParameter(f18 = c(init=1,lb=0,ub=10))
    model$setParameter(f19 = c(init=1,lb=0,ub=10))
    model$setParameter(f110 = c(init=1,lb=0,ub=10))
    model$setParameter(f111 = c(init=1,lb=0,ub=10))
    model$setParameter(f112 = c(init=1,lb=0,ub=10))
    model$setParameter(f113 = c(init=1,lb=0,ub=10))
    model$setParameter(f114 = c(init=1,lb=0,ub=10))
    model$setParameter(f115 = c(init=1,lb=0,ub=10))
    
    # model$setParameter(f20 = c(init=1,lb=0,ub=10))
    model$setParameter(f21 = c(init=1,lb=0,ub=10))
    model$setParameter(f22 = c(init=1,lb=0,ub=10))
    model$setParameter(f23 = c(init=1,lb=0,ub=10))
    model$setParameter(f24 = c(init=1,lb=0,ub=10))
    model$setParameter(f25 = c(init=1,lb=0,ub=10))
    model$setParameter(f26 = c(init=1,lb=0,ub=10))
    model$setParameter(f27 = c(init=1,lb=0,ub=10))
    model$setParameter(f28 = c(init=1,lb=0,ub=10))
    model$setParameter(f29 = c(init=1,lb=0,ub=10))
    model$setParameter(f210 = c(init=1,lb=0,ub=10))
    model$setParameter(f211 = c(init=1,lb=0,ub=10))
    model$setParameter(f212 = c(init=1,lb=0,ub=10))
    model$setParameter(f213 = c(init=1,lb=0,ub=10))
    model$setParameter(f214 = c(init=1,lb=0,ub=10))
    model$setParameter(f215 = c(init=1,lb=0,ub=10))


    return(model)}